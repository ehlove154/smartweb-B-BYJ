const menuMap = {
    recommendation: [{
        "name": "맥스파이시® 상하이 투움바 버거",
        "price": 10000,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2649.png?"
    }, {
        "name": "슈비 투움바 버거",
        "price": 10400,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2644.png?"
    }, {
        "name": "더블 쿼터파운더® 치즈",
        "price": 10400,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1130.png?"
    }, {
        "name": "토마토 치즈 비프 버거",
        "price": 6900,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1266.png?"
    }, {
        "name": "쿼터파운더® 치즈",
        "price": 8900,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1147.png?"
    }, {
        "name": "맥크리스피™ 디럭스 버거",
        "price": 9200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2061.png?"
    }, {
        "name": "맥크리스피™ 클래식 버거",
        "price": 8700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2031.png?"
    }, {
        "name": "빅맥®",
        "price": 8500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1101.png?"
    }, {
        "name": "한입 초코 츄러스 - 3조각",
        "price": 3200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2565.png?"
    }, {
        "name": "슈림프 스낵랩",
        "price": 3300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6050.png?"
    }, {
        "name": "바닐라 라떼",
        "price": 4500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3213.png?"
    }],
    burgers: [{
        "name": "맥스파이시® 상하이 투움바 버거",
        "price": 8100,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2648.png?"
    }, {
        "name": "슈비 투움바 버거",
        "price": 8500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2643.png?"
    }, {
        "name": "더블 쿼터파운더® 치즈",
        "price": 8200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1330.png?"
    }, {
        "name": "쿼터파운더® 치즈",
        "price": 6300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1347.png?"
    }, {
        "name": "맥스파이시® 상하이 버거",
        "price": 6300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1303.png?"
    }, {
        "name": "토마토 치즈 비프 버거",
        "price": 4600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1269.png?"
    }, {
        "name": "맥크리스피™ 디럭스 버거",
        "price": 7600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2060.png?"
    }, {
        "name": "맥크리스피™ 클래식 버거",
        "price": 6700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2030.png?"
    }, {
        "name": "빅맥®",
        "price": 6300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1301.png?"
    }, {
        "name": "트리플 치즈버거",
        "price": 6700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6332.png?"
    }, {
        "name": "1955® 버거",
        "price": 7200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1340.png?"
    }, {
        "name": "맥치킨® 모짜렐라",
        "price": 5800,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1356.png?"
    }, {
        "name": "맥치킨®",
        "price": 4300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1361.png?"
    }, {
        "name": "더블 불고기 버거",
        "price": 5300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6323.png?"
    }, {
        "name": "불고기 버거",
        "price": 4200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6322.png?"
    }, {
        "name": "슈슈 버거",
        "price": 5500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1432.png?"
    }, {
        "name": "슈비 버거",
        "price": 6600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1433.png?"
    }, {
        "name": "베이컨 토마토 디럭스",
        "price": 6600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1314.png?"
    }, {
        "name": "치즈버거",
        "price": 3600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6310.png?"
    }, {
        "name": "더블 치즈버거",
        "price": 5600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1312.png?"
    }, {
        "name": "햄버거",
        "price": 3400,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1320.png?"
    }],
    snacks: [{
        "name": "한입 초코 츄러스 - 3조각",
        "price": 3200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2565.png?"
    }, {
        "name": "슈림프 스낵랩",
        "price": 3300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6050.png?"
    }, {
        "name": "상하이 치킨 스낵랩",
        "price": 4000,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1260.png?"
    }, {
        "name": "코울슬로",
        "price": 2700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3149.png?"
    }, {
        "name": "골든 모짜렐라 치즈스틱 4조각",
        "price": 5300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6992.png?"
    }, {
        "name": "골든 모짜렐라 치즈스틱 2조각",
        "price": 3600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6991.png?"
    }, {
        "name": "맥너겟® 6조각",
        "price": 4700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1463.png?"
    }, {
        "name": "맥너겟® 4조각",
        "price": 3400,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/6202.png?"
    }, {
        "name": "맥스파이시® 치킨텐더 2조각",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1730.png?"
    }, {
        "name": "후렌치 후라이",
        "price": 3000,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1402.png?"
    }, {
        "name": "디핑소스 추가 구매 - 스위트 앤 사워 소스",
        "price": 300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1488.png?"
    }, {
        "name": "디핑소스 추가 구매 - 스위트 칠리 소스",
        "price": 300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1490.png?"
    }, {
        "name": "디핑소스 추가 구매 - 케이준 소스",
        "price": 300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1494.png?"
    }],
    beverages: [{
        "name": "코카-콜라",
        "price": 2600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1506.png?"
    }, {
        "name": "코카-콜라 제로",
        "price": 2600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1530.png?"
    }, {
        "name": "스프라이트",
        "price": 2600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1520.png?"
    }, {
        "name": "환타",
        "price": 2600,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1509.png?"
    }, {
        "name": "바닐라 라떼",
        "price": 4500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3213.png?"
    }, {
        "name": "카페라떼",
        "price": 4000,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1533.png?"
    }, {
        "name": "카푸치노",
        "price": 4000,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1534.png?"
    }, {
        "name": "아메리카노",
        "price": 3300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1532.png?"
    }, {
        "name": "드립 커피",
        "price": 2700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1553.png?"
    }, {
        "name": "아이스 바닐라 라떼",
        "price": 4500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3215.png?"
    }, {
        "name": "아이스 카페라떼 (시럽 없음)",
        "price": 4000,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1540.png?"
    }, {
        "name": "아이스 아메리카노 (시럽 없음)",
        "price": 3300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1896.png?"
    }, {
        "name": "아이스 드립 커피 (시럽 없음)",
        "price": 2700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/5203.png?"
    }, {
        "name": "디카페인 바닐라 라떼",
        "price": 4700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3194.png?"
    }, {
        "name": "디카페인 카페라떼",
        "price": 4200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3185.png?"
    }, {
        "name": "디카페인 카푸치노",
        "price": 4200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3190.png?"
    }, {
        "name": "디카페인 아메리카노",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3180.png?"
    }, {
        "name": "디카페인 아이스 바닐라 라떼",
        "price": 4700,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3196.png?"
    }, {
        "name": "디카페인 아이스 카페라떼 (시럽 없음)",
        "price": 4200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3187.png?"
    }, {
        "name": "디카페인 아이스 아메리카노 (시럽 없음)",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/3182.png?"
    }, {
        "name": "바닐라 쉐이크",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1703.png?"
    }, {
        "name": "딸기 쉐이크",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1701.png?"
    }, {
        "name": "초코 쉐이크",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1702.png?"
    }, {
        "name": "생수",
        "price": 2000,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1591.png?"
    }],
    desserts: [{
        "name": "한입 초코 츄러스 - 3조각",
        "price": 3200,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2565.png?"
    }, {
        "name": "오레오 맥플러리",
        "price": 4300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1732.png?"
    }, {
        "name": "베리 스트로베리 맥플러리",
        "price": 4300,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/2734.png?"
    }, {
        "name": "바닐라 쉐이크",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1703.png?"
    }, {
        "name": "딸기 쉐이크",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1701.png?"
    }, {
        "name": "초코 쉐이크",
        "price": 3500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1702.png?"
    }],
    happyMeals: [{
        "name": "맥너겟® - 4조각",
        "price": 5500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1203.png?"
    }, {
        "name": "불고기 버거",
        "price": 5500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1204.png?"
    }, {
        "name": "치즈버거",
        "price": 5500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1202.png?"
    }, {
        "name": "햄버거",
        "price": 5500,
        "imageUrl": "https://www.mcdelivery.co.kr/kr//static/1740550293814/assets/82/products/1201.png?"
    }]
};

const $dialogCover = document.getElementById('dialogCover');
const $dialog = document.getElementById(`dialog`);

const hideDialog = () => {
    $dialogCover.classList.remove('visible');
    $dialog.classList.remove('visible');
}

const showDialog = (content, onclick) => {
    $dialogCover.classList.add('visible');
    $dialog.querySelector(`:scope > .content`).innerText = content;
    $dialog.querySelector(`:scope > .ok`).onclick = () => {
        if (typeof onclick === `function`) {
            onclick();
        }
        hideDialog();
    };
    $dialog.classList.add(`visible`);
}

const $payCover = document.getElementById(`payCover`);
const $pay = document.getElementById(`pay`);

const hidePay = () => {
    $payCover.classList.remove(`visible`);
    $pay.classList.remove(`visible`);
}

const showPay = () => {
    const $menu = $pay.querySelector(`:scope > .menu`);
    $menu.innerHTML = ``;
    let total = 0;
    for (const name of Object.keys(cartMap)) {
        const cartObj = cartMap[name];
        total += cartObj['price'] * cartObj['quantity'];
        $menu.innerHTML += `
        <li class="item">
            <span class="name">${name}</span>
            <span class="count">(${cartObj['quantity']})</span>
            <span class="stretch"></span>
            <span class="price">${cartObj['price'] * cartObj['quantity']}원</span>
        </li>`;
    }
    $pay.querySelector(`:scope > .total`).innerText = `${total}원`;
    $payCover.classList.add(`visible`);
    $pay.classList.add(`visible`);
};

$pay.querySelector(`:scope > .button-container > .button.cancel`).addEventListener(`click`, hidePay);

$pay.querySelector(`:scope > .button-container > .button.confirm`).addEventListener(`click`, () => {
    if ($pay.querySelector(`:scope > .method-container > .label > .radio[value='card']`).checked === true) {
        showDialog(`현재 일시적으로 카드 결제가 불가능합니다.\n카운더에 문의해 주세요.`);
        return;
    }

    const date = new Date();
    const imp = window.IMP;
    const names = Object.keys(cartMap);
    let name = names[0];
    if (names.length > 1) {
        name += `외 ${names.length - 1}건`;
    }
    let amount = 0;
    names.forEach((name) => amount += cartMap[name]['price'] * cartMap[name]['quantity']);
    imp.init('imp36544176');
    imp.request_pay({
        pg: `kakaopay.TC0ONETIME`, //mid
        pay_method: `card`,
        merchant_uid: `IMP-${date.getTime()}`,
        name: `name`,
        amount: amount,
        buyer_email: `ehlove154@naver.com`,
        buyer_name: `백유정`,
    }, (resp) => {
        if (resp.success === true) {
            showDialog(`결제가 완료되었습니다.\n주문번호: 30`, () => location.reload());
        } else {
            showDialog(`결제에 실패하였습니다.\n(${resp['error_msg']})`);
        }
    });
});

$dialog.querySelector(`:scope > .ok`).addEventListener('click', hideDialog);

const $intro = document.getElementById(`intro`);

$intro.addEventListener(`mousedown`, () => {
    $intro.classList.remove('visible');
});

const $order = document.getElementById(`order`);
const $categoryForm = $order.querySelector(`:scope > .menu > .category`);
let cartMap = {};
$categoryForm[`category`].forEach($radio => {
    $radio.addEventListener(`change`, () => {
        if ($radio.checked === true) {
            const $list = $order.querySelector(`:scope > .menu > .list`);
            const menus = menuMap[$radio.value];
            let listHtml = ``;
            $list.innerHTML = ``;
            for (const menu of menus) {
                listHtml +=`
                    <li class="item" data-name="${menu['name']}" data-price="${menu['price']}">
                        <img src='${menu['imageUrl']}' alt="" class="image">
                        <div class="text-container">
                            <span class="name">${menu['name']}</span>
                            <span class="price">${menu['price']}</span>
                        </div>
                    </li>`;
            }
            $list.innerHTML = listHtml;
            $list.querySelectorAll(`:scope > .item`).forEach($item => {
               $item.addEventListener(`click`, () =>{
                   $order.querySelector(`:scope > .cart > .list > .message.empty`).classList.remove('visible');
                   const name = $item.dataset['name'];
                   const price = parseInt($item.dataset['price']);
                   cartMap[name] ??= {
                       name: name,
                       price: price,
                       quantity: 0
                   };
                   cartMap[name][`quantity`] += 1;

                   const calculateSum = () => {
                       let sum = 0;
                       for (const cartObject of Object.values(cartMap)) {
                           sum += cartObject[`price`] * cartObject[`quantity`];
                       }
                       // const sum = Object.values(cartMap).reduce((acc, cartObject) => acc + cartObject[`price`] + cartObject['quantity'], 0);
                       $order.querySelector(`:scope > .cart > .caption > .sum`).innerText = sum;
                   };

                   let $cartItem = $order.querySelector(`:scope > .cart > .list > .item[data-name='${name}']`);
                   if ($cartItem == null) {
                       const $list = $order.querySelector(`:scope > .cart > .list`);
                       $list.insertAdjacentHTML(`beforeend`, `
                       <li class="item" data-name="${name}">
                         <span class="name">${name}</span>
                         <span class="price">${price}</span>
                         <label class="quantity-wrapper">
                             <button class="button minus" type="button">-</button>
                             <input readonly type="text" class="quantity" value="1">
                             <button class="button plus" type="button">+</button>
                         </label>
                             <button class="remove" type="button">&#x2715</button>
                         </li>`);
                       // $list.innerHTML += `
                       // <li class="item" data-name="${name}">
                       //   <span class="name">${name}</span>
                       //   <span class="price">${price}</span>
                       //   <label class="quantity-wrapper">
                       //       <button class="button minus" type="button">-</button>
                       //       <input readonly type="text" class="quantity" value="1">
                       //       <button class="button plus" type="button">+</button>
                       //   </label>
                       //       <button class="remove" type="button">&#x2715</button>
                       //   </li>`;
                       $cartItem = $list.lastChild;
                       $cartItem.querySelector(`:scope > .quantity-wrapper > .button.minus`).addEventListener('click', () => {
                          if (cartMap[name][`quantity`] > 1) {
                              cartMap[name][`quantity`] -= 1;
                              $cartItem.querySelector(`:scope > .quantity-wrapper > .quantity`).value = cartMap[name][`quantity`];
                              calculateSum();
                          }
                       });
                       $cartItem.querySelector(`:scope > .quantity-wrapper > .button.plus`).addEventListener('click', () => {
                           if (cartMap[name][`quantity`] < 99) {
                               cartMap[name][`quantity`] += 1;
                               $cartItem.querySelector(`:scope > .quantity-wrapper > .quantity`).value = cartMap[name][`quantity`];
                               calculateSum();
                           }
                       });
                       $cartItem.querySelector(`:scope > .remove`).addEventListener(`click`, () => {
                           delete cartMap[name];
                           $cartItem.remove();
                           calculateSum();
                           if (Object.keys(cartMap).length === 0) {
                               $order.querySelector(`:scope > .cart > .list > .message.empty`).classList.add('visible');
                           }
                           calculateSum();
                       });
                   } else {
                       const  $quantity = $cartItem.querySelector(`:scope > .quantity-wrapper > .quantity`);
                       $quantity.value = cartMap[name][`quantity`];
                   }
                   calculateSum();
               });
            });
        }
    });
});
$categoryForm[`category`][0].dispatchEvent(new Event('change'));

$order.querySelector(`:scope > .button-container > .button.confirm`).addEventListener(`click`, () => {
    if (Object.keys(cartMap).length ===0) {
        showDialog(`장바구니에 상품을 추가해주세요.`);
        return;
    }
    showPay();
});